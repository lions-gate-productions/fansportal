<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lions Gate VIP Portal - Exclusive access for members">
    <title>Lions Gate VIP Portal</title>
    <link rel="stylesheet" href="/styles/tailwind.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #FFD700;
            --blue-dark: #1E3A8A;
            --purple-dark: #6B21A8;
        }
        * { -webkit-tap-highlight-color: transparent; user-select: none; }
        input, textarea { user-select: text; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(-45deg, #1a1a2e, #16213e, #0f3460, #1a1a2e);
            background-size: 400% 400%;
            animation: gradient-shift 15s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
        }
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease;
        }
        .glassmorphism:hover { transform: translateY(-2px); }
        .news-ticker {
            background: linear-gradient(90deg, #ff0080, #ff8c00, #40e0d0, #9932cc);
            background-size: 400% 100%;
            animation: gradient-shift 4s ease infinite;
            color: white;
            font-weight: bold;
            padding: 8px 0;
            white-space: nowrap;
            overflow: hidden;
        }
        .ticker-content {
            display: inline-block;
            animation: ticker 60s linear infinite;
            padding-left: 100%;
            font-size: 12px;
        }
        .modal {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }
        .modal.active { opacity: 1; visibility: visible; }
        .modal-content {
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal.active .modal-content { transform: scale(1); }
        .btn-primary {
            background: linear-gradient(45deg, var(--blue-dark), var(--purple-dark));
            color: white;
            font-weight: 700;
            border-radius: 8px;
            padding: 10px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
        }
        .btn-primary:hover { transform: translateY(-2px); }
        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        .voice-assistant {
            position: fixed;
            bottom: 15px;
            left: 15px;
            z-index: 100;
        }
        .voice-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .voice-btn.listening { animation: pulse 1s infinite; }
        .voice-status {
            position: absolute;
            bottom: 60px;
            left: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 16px;
            font-size: 12px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        .voice-status.active { opacity: 1; transform: translateY(0); }
        .download-prompt {
            position: fixed;
            bottom: 15px;
            right: 15px;
            z-index: 999;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            max-width: 90%;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        .download-prompt.active { transform: translateY(0); opacity: 1; }
        .volunteer-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.2s ease;
        }
        .volunteer-card:hover { transform: translateY(-3px); }
        @media (min-width: 768px) {
            .ticker-content { font-size: 14px; }
            .news-ticker { padding: 10px 0; }
            .glassmorphism { padding: 1.5rem; }
            .voice-btn { width: 60px; height: 60px; }
            .voice-status { font-size: 14px; padding: 10px 15px; }
            .download-prompt { max-width: 300px; }
            .btn-primary { padding: 12px; min-height: 44px; }
            .loading-spinner { width: 20px; height: 20px; border-width: 3px; }
            .container { max-width: 1200px; }
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes gradient-shift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
    </style>
</head>
<body>
    <canvas id="three-canvas" aria-hidden="true"></canvas>
    <div class="voice-assistant" role="region" aria-label="Voice Assistant">
        <div class="voice-status" id="voice-status">Say "Hey Portal" to start</div>
        <button class="voice-btn" id="voice-btn" title="Voice Assistant" aria-label="Toggle Voice Assistant">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
            </svg>
        </button>
    </div>
    <div id="download-app-prompt" class="download-prompt">
        <p class="text-white text-sm mb-2">Download the Lions Gate VIP App!</p>
        <div class="flex gap-2">
            <button id="download-app-btn" class="btn-primary flex-1 text-sm py-2">Download</button>
            <button id="dismiss-app-prompt" class="flex-1 bg-gray-600 text-white text-sm py-2 rounded-lg">Dismiss</button>
        </div>
    </div>
    <div id="loading-screen" class="fixed inset-0 bg-gradient-to-br from-blue-600 to-purple-800 z-[9999] flex items-center justify-center">
        <div class="text-center text-white">
            <div class="loading-spinner mb-3"></div>
            <p class="text-lg font-semibold">Loading...</p>
        </div>
    </div>
    <div id="news-ticker" class="news-ticker" role="marquee" aria-live="polite">
        <div class="ticker-content" id="ticker-text"></div>
    </div>
    <div id="main-content" class="opacity-0 transition-opacity duration-300">
        <div class="container mx-auto px-2 py-4">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                <div class="flex items-center mb-3 sm:mb-0">
                    <div class="w-10 h-10 mr-2 rounded-full overflow-hidden border-2 border-gold">
                        <img src="/images/profile.jpg" alt="Joan Luiser" class="w-full h-full object-cover" loading="lazy">
                    </div>
                    <div>
                        <h1 class="text-base font-bold text-white" data-app-value="memberName">Joan Luiser</h1>
                        <div class="flex items-center space-x-2">
                            <div class="points-badge text-xs bg-red-500/80 text-white px-2 py-1 rounded">SUSPENDED</div>
                            <div class="security-badge bg-green-500/80 text-white text-xs px-2 py-1 rounded">SECURE</div>
                        </div>
                    </div>
                </div>
                <button id="contact-support-btn" aria-label="Contact Support" class="p-2 rounded-full bg-white/10 hover:bg-white/20 min-h-[40px] min-w-[40px]">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                </button>
            </div>
            <nav class="bg-white/5 backdrop-blur-sm border-b border-white/10 mb-4">
                <div class="flex space-x-2 overflow-x-auto">
                    <button class="nav-btn py-2 px-3 text-white border-b-2 border-gold text-sm" data-page="dashboard" aria-current="page">üè† Dashboard</button>
                    <button class="nav-btn py-2 px-3 text-white border-b-2 border-transparent hover:border-gold text-sm" data-page="security">üîí Security</button>
                    <button class="nav-btn py-2 px-3 text-white border-b-2 border-transparent hover:border-gold text-sm" data-page="volunteer">‚ù§Ô∏è Volunteer</button>
                </div>
            </nav>
            <main id="page-content">
                <div id="dashboard-page" class="page-content">
                    <section class="mb-4 glassmorphism rounded-lg p-4 border-2 border-red-500/80">
                        <div class="flex flex-col sm:flex-row items-center justify-between gap-3">
                            <div>
                                <h2 class="text-lg font-bold text-white">‚ö†Ô∏è Account Reactivation Required</h2>
                                <p class="text-yellow-300 font-semibold">Expires in 6 days!</p>
                                <p class="text-white/80 text-sm">Contact support to reactivate.</p>
                            </div>
                            <button id="reactivate-now-btn" class="btn-primary w-full sm:w-auto px-4 py-2 text-sm">Reactivate Now</button>
                        </div>
                    </section>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                        <div class="lg:col-span-1 space-y-4">
                            <section id="profile-section" class="glassmorphism rounded-lg p-4 text-center">
                                <div class="w-20 h-20 mx-auto mb-3 rounded-full overflow-hidden border-2 border-gold">
                                    <img src="/images/profile.jpg" alt="Joan Luiser" class="w-full h-full object-cover" loading="lazy">
                                </div>
                                <h2 class="text-lg font-bold text-white" data-app-value="memberName">Joan Luiser</h2>
                                <p class="text-white/70 text-sm">Member ID: <span data-app-value="memberId">JL-1408-LG</span></p>
                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-3 py-1 rounded-full text-sm font-bold">üåü VIP DOUBLE STAR</div>
                            </section>
                            <section id="membership-card-section" class="glassmorphism rounded-lg p-4">
                                <h3 class="text-lg font-bold text-white mb-3 text-center">Digital Membership Card</h3>
                                <div id="membership-card-downloadable" class="p-2 bg-black/50 rounded-lg">
                                    <div class="p-3 bg-gradient-to-br from-gray-800 to-black rounded-lg border border-white/10">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="text-lg font-bold text-white"><span class="text-blue-600">LIONS</span><span class="text-gold">GATE</span></div>
                                            <div class="text-xs text-white/70">VIP DOUBLE STAR</div>
                                        </div>
                                        <div class="flex items-center space-x-2 mb-3">
                                            <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-gold">
                                                <img src="/images/profile.jpg" alt="Joan Luiser" class="w-full h-full object-cover" loading="lazy">
                                            </div>
                                            <div>
                                                <h3 class="font-bold text-sm text-white" data-app-value="memberName">Joan Luiser</h3>
                                                <p class="text-xs text-white/70" data-app-value="memberId">JL-1408-LG</p>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 text-xs mb-3">
                                            <div><div class="text-white/60">Status</div><div class="text-red-400">SUSPENDED</div></div>
                                            <div><div class="text-white/60">Member Since</div><div class="text-white">2023</div></div>
                                        </div>
                                        <div class="border-t border-white/20 pt-2 flex justify-between">
                                            <div class="text-xs text-white/60">VIP Portal</div>
                                            <div id="qr-code-small" class="w-6 h-6 bg-white rounded"></div>
                                        </div>
                                    </div>
                                </div>
                                <button id="download-card-btn" class="w-full mt-3 btn-primary py-2 text-sm">Download VIP Card</button>
                            </section>
                        </div>
                        <div class="lg:col-span-2">
                            <section id="news-blog-section" class="glassmorphism rounded-lg p-4">
                                <h3 class="text-lg font-bold text-white mb-3">üì∞ News & Blog</h3>
                                <div id="news-blog-container" class="space-y-3 max-h-[600px] overflow-y-auto">
                                    <div class="bg-white/5 rounded-lg p-3 border border-white/10">
                                        <div class="flex justify-between mb-2">
                                            <span class="text-gold font-bold text-xs">Lionsgate Insider</span>
                                            <span class="text-white/60 text-xs">August 6, 2025</span>
                                        </div>
                                        <h4 class="text-base font-semibold text-white mb-1">Keanu Reeves' 2025 World Tour</h4>
                                        <p class="text-white/90 text-sm">Keanu kicks off his global tour on August 10, 2025, with exclusive fan meet-and-greets.</p>
                                    </div>
                                    <div class="bg-white/5 rounded-lg p-3 border border-white/10">
                                        <div class="flex justify-between mb-2">
                                            <span class="text-gold font-bold text-xs">Music Weekly</span>
                                            <span class="text-white/60 text-xs">August 6, 2025</span>
                                        </div>
                                        <h4 class="text-base font-semibold text-white mb-1">New Album 'Echoes in the Static'</h4>
                                        <p class="text-white/90 text-sm">Keanu‚Äôs album, featuring 'Joan,' releases alongside his tour.</p>
                                    </div>
                                    <div class="bg-white/5 rounded-lg p-3 border border-white/10">
                                        <div class="flex justify-between mb-2">
                                            <span class="text-gold font-bold text-xs">Variety</span>
                                            <span class="text-white/60 text-xs">August 6, 2025</span>
                                        </div>
                                        <h4 class="text-base font-semibold text-white mb-1">Keanu‚Äôs Charitable Impact</h4>
                                        <p class="text-white/90 text-sm">Keanu‚Äôs foundation supports 45+ orphanages and raises $2.8M for cancer research.</p>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
                <div id="security-page" class="page-content hidden">
                    <h2 class="text-lg font-bold text-white mb-3">üîí Security Center</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="glassmorphism rounded-lg p-4">
                            <h4 class="text-base font-bold text-white mb-2">Fraud Protection</h4>
                            <p class="text-white/80 text-sm">AI monitoring to keep your account secure.</p>
                        </div>
                        <div class="glassmorphism rounded-lg p-4">
                            <h4 class="text-base font-bold text-white mb-2">Report Activity</h4>
                            <button id="report-fraud-btn" class="w-full btn-primary py-2 text-sm">Report Now</button>
                        </div>
                    </div>
                </div>
                <div id="volunteer-page" class="page-content hidden">
                    <h2 class="text-lg font-bold text-white mb-3 text-center">‚ù§Ô∏è Volunteer Hub</h2>
                    <section class="mb-4">
                        <div class="glassmorphism rounded-lg p-4">
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                <div>
                                    <div class="text-2xl font-bold text-gold">45+</div>
                                    <p class="text-sm text-white/60">Orphanages Supported</p>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-gold">$2.8M</div>
                                    <p class="text-sm text-white/60">Cancer Research</p>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-gold">12,500+</div>
                                    <p class="text-sm text-white/60">Children Helped</p>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-gold">892</div>
                                    <p class="text-sm text-white/60">Lives Saved</p>
                                </div>
                            </div>
                        </div>
                    </section>
                    <section class="mb-4">
                        <h3 class="text-base font-bold text-white mb-3 text-center">üî¨ Cancer Research Initiatives</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="volunteer-card rounded-lg p-3 border border-white/10">
                                <div class="flex justify-between mb-2">
                                    <span class="text-gold font-bold text-xs">Global Health</span>
                                    <span class="text-white/60 text-xs">August 6, 2025</span>
                                </div>
                                <h4 class="text-base font-semibold text-white mb-1">Pediatric Cancer Breakthroughs</h4>
                                <p class="text-white/90 text-sm">Join Keanu Reeves in funding cutting-edge leukemia research, saving young lives through innovative treatments.</p>
                                <button id="donate-cancer-btn" class="w-full mt-2 btn-primary py-2 text-sm">Support Now</button>
                            </div>
                            <div class="volunteer-card rounded-lg p-3 border border-white/10">
                                <div class="flex justify-between mb-2">
                                    <span class="text-gold font-bold text-xs">Medical Innovator</span>
                                    <span class="text-white/60 text-xs">August 6, 2025</span>
                                </div>
                                <h4 class="text-base font-semibold text-white mb-1">Breast Cancer Detection</h4>
                                <p class="text-white/90 text-sm">Support early detection tech for breast cancer, backed by Keanu‚Äôs foundation, to improve survival rates.</p>
                                <button id="donate-breast-cancer-btn" class="w-full mt-2 btn-primary py-2 text-sm">Join Initiative</button>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h3 class="text-base font-bold text-white mb-3 text-center">üè† Orphanage Support Programs</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="volunteer-card rounded-lg p-3 border border-white/10">
                                <div class="flex justify-between mb-2">
                                    <span class="text-gold font-bold text-xs">Hope Rising</span>
                                    <span class="text-white/60 text-xs">August 6, 2025</span>
                                </div>
                                <h4 class="text-base font-semibold text-white mb-1">Sunshine Children‚Äôs Home</h4>
                                <p class="text-white/90 text-sm">Volunteer in Kenya to provide educational resources for 150 children, inspired by Keanu‚Äôs mission.</p>
                                <button id="volunteer-orphanage-btn" class="w-full mt-2 btn-primary py-2 text-sm">Get Involved</button>
                            </div>
                            <div class="volunteer-card rounded-lg p-3 border border-white/10">
                                <div class="flex justify-between mb-2">
                                    <span class="text-gold font-bold text-xs">Future Stars</span>
                                    <span class="text-white/60 text-xs">August 6, 2025</span>
                                </div>
                                <h4 class="text-base font-semibold text-white mb-1">Hope Valley Orphanage</h4>
                                <p class="text-white/90 text-sm">Support 85 children in Uganda with healthcare and vocational training for a brighter future.</p>
                                <button id="support-hope-valley-btn" class="w-full mt-2 btn-primary py-2 text-sm">Contribute Now</button>
                            </div>
                        </div>
                    </section>
                </div>
            </main>
        </div>
        <div id="upgrade-modal" class="modal" role="dialog" aria-modal="true">
            <div class="absolute inset-0 bg-black/60" data-close-modal></div>
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="modal-content glassmorphism rounded-lg max-w-md w-full">
                    <div class="p-4 text-center">
                        <h3 class="text-lg font-bold text-white">Welcome to the VIP Portal!</h3>
                        <p class="text-white/80 text-sm mt-2">Explore your exclusive benefits, Joan Luiser.</p>
                        <button data-close-modal class="w-full mt-3 btn-primary py-2 text-sm">Get Started</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="toast-container" class="fixed top-16 right-4 z-[9999] space-y-2 max-w-xs"></div>
    </div>
    <script>
        // Optimized Three.js Animation
        function init3DBackground() {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(1); // Optimize for mobile
            const particles = new THREE.Group();
            const geometry = new THREE.SphereGeometry(0.08, 8, 8);
            const material = new THREE.MeshBasicMaterial({ color: 0xffd700, transparent: true, opacity: 0.5 });
            for (let i = 0; i < 50; i++) {
                const particle = new THREE.Mesh(geometry, material);
                particle.position.set((Math.random() - 0.5) * 60, (Math.random() - 0.5) * 60, (Math.random() - 0.5) * 60);
                particle.userData = { velocity: new THREE.Vector3((Math.random() - 0.5) * 0.03, (Math.random() - 0.5) * 0.03, (Math.random() - 0.5) * 0.03) };
                particles.add(particle);
            }
            scene.add(particles);
            camera.position.z = 30;
            function animate() {
                requestAnimationFrame(animate);
                particles.children.forEach(p => {
                    p.position.add(p.userData.velocity);
                    if (p.position.distanceTo(new THREE.Vector3(0, 0, 0)) > 30) {
                        p.position.set((Math.random() - 0.5) * 60, (Math.random() - 0.5) * 60, (Math.random() - 0.5) * 60);
                    }
                });
                particles.rotation.y += 0.001;
                renderer.render(scene, camera);
            }
            animate();
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        class AppState {
            constructor() {
                this.data = {
                    isActivated: false,
                    memberName: 'Joan Luiser',
                    memberId: 'JL-1408-LG',
                    status: 'VIP Double Star',
                    memberSince: '2023',
                };
                this.voiceCommands = {
                    'dashboard': () => this.navigateTo('dashboard'),
                    'security': () => this.navigateTo('security'),
                    'volunteer': () => this.navigateTo('volunteer'),
                    'help': () => this.speak('Commands: dashboard, security, volunteer, help'),
                    'reactivate': () => document.getElementById('reactivate-now-btn')?.click(),
                    'contact support': () => document.getElementById('contact-support-btn')?.click()
                };
            }
            get(key) { return this.data[key]; }
            set(key, value) {
                this.data[key] = value;
                document.querySelectorAll(`[data-app-value="${key}"]`).forEach(el => el.textContent = value);
            }
            navigateTo(page) {
                document.querySelector(`.nav-btn[data-page="${page}"]`)?.click();
                this.speak(`Navigating to ${page}`);
            }
            speak(text) {
                if ('speechSynthesis' in window && speech_enabled) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9;
                    speechSynthesis.speak(utterance);
                }
            }
            createMailtoLink(subject, body, recipient = 'erwinstoff0766@gmail.com') {
                const memberInfo = `\n\nMember: ${this.get('memberName')}\nID: ${this.get('memberId')}`;
                window.location.href = `mailto:${recipient}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body + memberInfo)}`;
            }
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                modal?.classList.add('active');
                modal?.querySelector('button')?.focus();
            }
            hideModal(modalId) {
                document.getElementById(modalId)?.classList.remove('active');
            }
        }

        class VoiceAssistant {
            constructor(appState) {
                this.appState = appState;
                this.isListening = false;
                this.recognition = null;
                this.init();
            }
            init() {
                try {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    if (!SpeechRecognition) return;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.lang = 'en-US';
                    this.recognition.onstart = () => {
                        this.isListening = true;
                        this.updateUI('Listening...');
                    };
                    this.recognition.onresult = (event) => this.processCommand(event.results[0][0].transcript.toLowerCase());
                    this.recognition.onend = () => {
                        this.isListening = false;
                        this.updateUI('Say "Hey Portal"');
                    };
                    document.getElementById('voice-btn')?.addEventListener('click', () => {
                        this.isListening ? this.recognition.stop() : this.recognition.start();
                    });
                    if (speech_enabled) {
                        this.appState.speak('Welcome to the Lions Gate VIP Portal! Navigate with voice commands or download your VIP card.');
                    }
                } catch (e) {
                    console.error('Voice init error:', e);
                }
            }
            processCommand(transcript) {
                this.updateUI(`Heard: "${transcript}"`);
                if (transcript.includes('hey portal')) {
                    this.appState.speak('Hello! How can I assist you?');
                } else {
                    const command = Object.keys(this.appState.voiceCommands).find(cmd => transcript.includes(cmd));
                    if (command) this.appState.voiceCommands[command]();
                    else this.appState.speak('Try saying "help" for commands.');
                }
            }
            updateUI(message) {
                const status = document.getElementById('voice-status');
                const btn = document.getElementById('voice-btn');
                if (status) {
                    status.textContent = message;
                    status.classList.add('active');
                    setTimeout(() => status.classList.remove('active'), 2000);
                }
                btn?.classList.toggle('listening', this.isListening);
            }
        }

        const appState = new AppState();
        let speech_enabled = true;
        const voiceAssistant = new VoiceAssistant(appState);

        const tickerManager = {
            messages: [
                "üé¨ Welcome to Lions Gate VIP Portal!",
                "üöÄ John Wick 5 - among top movies in 2025!",
                "üåü 'Ballerina 2' screening - november 2025",
                "üé≠ Keanu Q&A - aug 19, 2025",
                "üéØ Support Keanu‚Äôs charities",
                "üíé Reactivate your account!"
            ],
            init() {
                const tickerElement = document.getElementById('ticker-text');
                if (tickerElement) {
                    tickerElement.innerHTML = this.messages.map(msg => `&nbsp;&nbsp;${msg}`).join('');
                }
            }
        };

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `bg-${type === 'success' ? 'green' : 'red'}-500 text-white px-3 py-2 rounded-lg`;
            toast.textContent = message;
            toastContainer.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function showAppDownloadPrompt() {
            if (localStorage.getItem('appDownloadDismissed')) return;
            const prompt = document.getElementById('download-app-prompt');
            if (prompt) {
                setTimeout(() => {
                    prompt.classList.add('active');
                    setTimeout(() => prompt.classList.remove('active'), 10000);
                }, 1000);
                document.getElementById('download-app-btn')?.addEventListener('click', () => {
                    localStorage.setItem('appDownloadDismissed', 'true');
                    window.location.href = 'https://lionsgatevip.com/app';
                    prompt.classList.remove('active');
                });
                document.getElementById('dismiss-app-prompt')?.addEventListener('click', () => {
                    localStorage.setItem('appDownloadDismissed', 'true');
                    prompt.classList.remove('active');
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            init3DBackground();
            appState.updateUI();
            tickerManager.init();
            showAppDownloadPrompt();

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.nav-btn').forEach(b => {
                        b.classList.replace('border-gold', 'border-transparent');
                        b.removeAttribute('aria-current');
                    });
                    btn.classList.replace('border-transparent', 'border-gold');
                    btn.setAttribute('aria-current', 'page');
                    document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
                    document.getElementById(btn.dataset.page + '-page')?.classList.remove('hidden');
                });
            });

            const actions = {
                'reactivate-now-btn': () => appState.createMailtoLink('Account Reactivation', 'Please reactivate my VIP account.'),
                'contact-support-btn': () => appState.createMailtoLink('Support Inquiry', 'I need assistance with my account.'),
                'report-fraud-btn': () => appState.createMailtoLink('Report Suspicious Activity', 'I want to report an issue.'),
                'donate-cancer-btn': () => appState.createMailtoLink('Cancer Research Donation', 'I want to support pediatric cancer research.'),
                'donate-breast-cancer-btn': () => appState.createMailtoLink('Breast Cancer Donation', 'I want to support breast cancer initiatives.'),
                'volunteer-orphanage-btn': () => appState.createMailtoLink('Volunteer in Kenya', 'I‚Äôm interested in volunteering for Sunshine Children‚Äôs Home.'),
                'support-hope-valley-btn': () => appState.createMailtoLink('Support Hope Valley', 'How can I help Hope Valley Orphanage?')
            };
            Object.keys(actions).forEach(id => document.getElementById(id)?.addEventListener('click', actions[id]));

            document.getElementById('download-card-btn')?.addEventListener('click', async (e) => {
                const button = e.currentTarget;
                const originalHTML = button.innerHTML;
                button.innerHTML = '<div class="loading-spinner mr-2"></div>Generating...';
                button.disabled = true;
                try {
                    const canvas = await html2canvas(document.getElementById('membership-card-downloadable'), { scale: 2 });
                    const link = document.createElement('a');
                    link.download = `VIP_Card_${appState.get('memberId')}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    showToast('Card downloaded!', 'success');
                } catch (err) {
                    showToast('Download failed.', 'error');
                } finally {
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                }
            });

            const qrContainer = document.getElementById('qr-code-small');
            if (qrContainer && QRCode) {
                QRCode.toDataURL(`VIP_ID:${appState.get('memberId')}`, { width: 48, margin: 1 }, (err, url) => {
                    if (!err) qrContainer.innerHTML = `<img src="${url}" alt="QR Code" loading="lazy">`;
                });
            }

            document.querySelectorAll('[data-close-modal]').forEach(el => {
                el.addEventListener('click', () => appState.hideModal(el.closest('.modal').id));
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.querySelectorAll('.modal.active').forEach(m => appState.hideModal(m.id));
            });

            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                setTimeout(() => {
                    loadingScreen.style.opacity = '0';
                    document.getElementById('main-content').style.opacity = '1';
                    setTimeout(() => {
                        loadingScreen.remove();
                        appState.showModal('upgrade-modal');
                    }, 300);
                }, 800);
            }
        });
    </script>
</body>
</html>
